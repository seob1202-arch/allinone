<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ì¶¤ ì—¬í–‰ ìƒí’ˆ ì¶”ì²œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        /* --- CSS Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary: #667eea; --primary-dark: #5568d3; --secondary: #764ba2; --accent: #f093fb; --success: #10b981; --warning: #f59e0b; --danger: #ef4444; --dark: #1a202c; --gray: #718096; --light: #f7fafc; }
        body { font-family: 'Noto Sans KR', 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; line-height: 1.6; color: #333; background: #ffffff; overflow-x: hidden; word-break: keep-all; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        
        /* Loading Screen */
        .initial-loading { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); z-index: 10000; display: flex; justify-content: center; align-items: center; flex-direction: column; color: white; }
        .initial-loading.hidden { display: none; }
        
        /* Header */
        .hero {
            background-color: #1a202c;
            background-image: linear-gradient(135deg, #1a202c 0%, #111827 50%, #0F172A 100%), 
                              url('data:image/svg+xml;charset=UTF-8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100" fill-opacity=".015" fill="white"%3E%3Crect width="1" height="1"/%3E%3C/svg%3E');
            color: white;
            padding: 120px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero-content { position: relative; z-index: 2; }

        /* ì§€ì—­ ì„ íƒ ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        .region-selector-wrapper {
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .region-selector-label {
            font-size: 1em;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 600;
        }

        .region-selector-dropdown {
            position: relative;
            display: inline-block;
        }

        .region-select {
            appearance: none;
            background: rgba(255, 255, 255, 0.95);
            color: var(--dark);
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 15px 50px 15px 25px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            font-family: 'Noto Sans KR', sans-serif;
            min-width: 200px;
        }

        .region-select:hover {
            background: white;
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4);
            transform: translateY(-2px);
        }

        .region-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .region-selector-dropdown::after {
            content: 'â–¼';
            position: absolute;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 0.8em;
            pointer-events: none;
        }

        .hero h1 {
            font-size: 3.2em;
            margin-bottom: 25px;
            font-weight: 900;
            line-height: 1.3;
            background: linear-gradient(180deg, #FFFFFF 60%, #E0E7FF 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.2em;
            margin-bottom: 45px;
            color: rgba(230, 230, 230, 0.85);
            font-weight: 400;
            line-height: 1.5;
        }

        .cta-button {
            background: white;
            color: var(--primary);
            padding: 20px 50px;
            border: none;
            border-radius: 50px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .cta-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            z-index: -1;
        }
        .cta-button:hover::before { left: 100%; }
        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .trust-indicators {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 60px;
            flex-wrap: wrap;
        }

        .trust-item {
            font-size: 0.95em;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 30px;
            backdrop-filter: blur(5px);
            white-space: nowrap;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
            transition: background 0.3s;
        }
        .trust-item:hover { background: rgba(255, 255, 255, 0.1); }

        /* Survey Section */
        .survey-section { background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%); padding: 80px 20px; }
        .survey-section h2 { text-align: center; font-size: 2.5em; margin-bottom: 15px; color: var(--dark); font-weight: 900; }
        .survey-section .subtitle { text-align: center; color: var(--gray); margin-bottom: 60px; font-size: 1.2em; }
        .progress-container { max-width: 600px; margin: 0 auto 50px; }
        .progress-bar { background: #e2e8f0; height: 12px; border-radius: 10px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); }
        .progress-fill { background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%); height: 100%; width: 25%; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); border-radius: 10px; box-shadow: 0 0 10px rgba(102, 126, 234, 0.5); }
        .progress-text { text-align: center; margin-top: 10px; color: var(--gray); font-weight: 600; }
        .question { display: none; animation: fadeInUp 0.6s; }
        .question.active { display: block; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .question h3 { font-size: 1.8em; margin-bottom: 40px; text-align: center; color: var(--dark); font-weight: 700; }
        .question-nav { text-align: center; margin-bottom: 30px; }
        .btn-back { background: transparent; border: 2px solid var(--gray); color: var(--gray); padding: 10px 30px; border-radius: 25px; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .btn-back:hover { background: var(--gray); color: white; }
        .options { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; max-width: 1000px; margin: 0 auto; }
        .option { background: white; border: 3px solid #e2e8f0; padding: 35px 25px; border-radius: 20px; cursor: pointer; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); text-align: center; position: relative; overflow: hidden; }
        .option::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent); transition: left 0.5s; }
        .option:hover::before { left: 100%; }
        .option:hover { border-color: var(--primary); transform: translateY(-8px); box-shadow: 0 15px 40px rgba(102, 126, 234, 0.25); }
        .option.selected { border-color: var(--primary); background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3); }
        .option-icon { font-size: 3.5em; margin-bottom: 15px; filter: grayscale(0.3); transition: filter 0.3s; }
        .option:hover .option-icon, .option.selected .option-icon { filter: grayscale(0); }
        .option-text { font-weight: 700; color: var(--dark); margin-bottom: 8px; font-size: 1.1em; }
        .option-desc { font-size: 0.95em; color: var(--gray); }
        
        /* Loading Screen */
        .loading-screen { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); z-index: 9999; justify-content: center; align-items: center; flex-direction: column; color: white; }
        .loading-screen.active { display: flex; }
        .loader { width: 80px; height: 80px; border: 8px solid rgba(255,255,255,0.2); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { margin-top: 30px; font-size: 1.5em; font-weight: 700; animation: pulse 1.5s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        /* Results Section */
        .results-section { background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%); padding: 80px 20px; display: none; }
        .results-section.active { display: block; }
        .results-header { text-align: center; margin-bottom: 40px; }
        .results-header h2 { font-size: 2.8em; color: var(--dark); margin-bottom: 20px; font-weight: 900; }
        .results-header p { font-size: 1.3em; color: var(--gray); font-weight: 500; }
        .profile-card { background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: white; padding: 50px 40px; border-radius: 30px; margin-bottom: 60px; box-shadow: 0 15px 50px rgba(102, 126, 234, 0.3); }
        .profile-content { display: flex; justify-content: space-between; align-items: center; gap: 40px; flex-wrap: wrap; }
        .profile-info { flex: 1; min-width: 250px; }
        .profile-info h3 { font-size: 1.8em; margin-bottom: 25px; font-weight: 700; }
        .profile-badges { display: flex; flex-wrap: wrap; gap: 12px; }
        .badge { background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 20px; font-weight: 600; font-size: 0.95em; border: 1px solid rgba(255,255,255,0.3); backdrop-filter: blur(10px); }
        .radar-chart-container { flex: 1; min-width: 250px; max-width: 400px; height: 300px; background: rgba(255,255,255,0.95); border-radius: 20px; padding: 20px; }
        .chart-description { text-align: center; margin-top: 20px; font-size: 1em; opacity: 0.9; font-weight: 500; }
        .timeline { margin-top: 60px; }
        .timeline-step { background: white; border-radius: 30px; padding: 40px; margin-bottom: 40px; box-shadow: 0 5px 25px rgba(0,0,0,0.08); }
        .step-header { display: flex; align-items: center; gap: 25px; margin-bottom: 35px; }
        .step-icon { font-size: 3.5em; }
        .step-info { flex: 1; }
        .step-title { font-size: 1.8em; font-weight: 700; color: var(--dark); margin-bottom: 5px; }
        .step-subtitle { color: var(--gray); font-size: 1.1em; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }
        .product-card { background: #f8f9fa; border: 2px solid #e2e8f0; border-radius: 20px; padding: 30px; transition: all 0.4s; cursor: pointer; position: relative; overflow: hidden; }
        .product-card::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.05), transparent); transition: left 0.5s; }
        .product-card:hover::before { left: 100%; }
        .product-card:hover { border-color: var(--primary); transform: translateY(-5px); box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2); }
        .product-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        .product-name { font-size: 1.3em; font-weight: 700; color: var(--dark); flex: 1; line-height: 1.3; }
        .product-price { background: var(--primary); color: white; padding: 8px 16px; border-radius: 20px; font-weight: 700; font-size: 0.95em; white-space: nowrap; margin-left: 10px; }
        .product-reason { background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); color: var(--primary); padding: 12px 18px; border-radius: 15px; font-weight: 600; margin-bottom: 15px; font-size: 0.95em; }
        .product-desc { color: var(--gray); margin-bottom: 15px; line-height: 1.6; font-size: 0.95em; }
        .product-tags { display: flex; flex-wrap: wrap; gap: 8px; }
        .product-tag { background: white; border: 1px solid #e2e8f0; padding: 6px 14px; border-radius: 15px; font-size: 0.85em; color: var(--gray); font-weight: 500; }
        .email-capture { background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: white; padding: 50px 40px; border-radius: 30px; text-align: center; margin-top: 60px; }
        .email-capture h3 { font-size: 2em; margin-bottom: 15px; font-weight: 700; }
        .email-capture p { font-size: 1.1em; margin-bottom: 30px; opacity: 0.9; }
        .url-display { margin: 20px 0; }
        .url-display input { width: 100%; max-width: 600px; padding: 15px; border: 2px solid rgba(255,255,255,0.3); border-radius: 15px; font-size: 1em; text-align: center; background: rgba(255,255,255,0.95); }
        .email-submit { background: white; color: var(--primary); border: none; padding: 18px 45px; border-radius: 50px; font-size: 1.1em; font-weight: 700; cursor: pointer; transition: all 0.3s; }
        .email-submit:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
        .email-success { display: none; margin-top: 20px; background: rgba(16, 185, 129, 0.2); border: 2px solid rgba(16, 185, 129, 0.5); padding: 15px; border-radius: 15px; font-weight: 600; }
        .email-success.show { display: block; }
        .exit-popup { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 10000; justify-content: center; align-items: center; animation: fadeIn 0.3s; }
        .exit-popup.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .exit-popup-content { background: white; padding: 50px 40px; border-radius: 30px; max-width: 500px; text-align: center; animation: slideUp 0.3s; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .exit-popup h3 { font-size: 2em; margin-bottom: 20px; color: var(--dark); }
        .exit-popup p { font-size: 1.1em; margin-bottom: 30px; color: var(--gray); }
        .exit-popup-buttons { display: flex; gap: 15px; justify-content: center; }
        .exit-popup-buttons button { padding: 15px 35px; border-radius: 25px; font-size: 1em; font-weight: 600; cursor: pointer; transition: all 0.3s; border: none; }
        .btn-stay { background: var(--primary); color: white; }
        .btn-stay:hover { background: var(--primary-dark); }
        .btn-leave { background: transparent; border: 2px solid var(--gray); color: var(--gray); }
        .btn-leave:hover { background: var(--gray); color: white; }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .hero h1 { font-size: 2em; }
            .hero p { font-size: 1em; }
            .region-select { font-size: 1em; padding: 12px 40px 12px 20px; min-width: 180px; }
            .survey-section h2 { font-size: 1.8em; }
            .question h3 { font-size: 1.4em; }
            .options { grid-template-columns: 1fr; }
            .results-header h2 { font-size: 2em; }
            .profile-content { flex-direction: column; }
            .products-grid { grid-template-columns: 1fr; }
            .trust-indicators { gap: 15px; }
        }
    </style>
</head>
<body>

    <!-- Initial Loading Screen -->
    <div class="initial-loading" id="initialLoading">
        <div class="loader"></div>
        <div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>

    <!-- Hero Section -->
    <header class="hero" id="heroSection">
        <div class="hero-content">
            <!-- ì§€ì—­ ì„ íƒ ë“œë¡­ë‹¤ìš´ -->
            <div class="region-selector-wrapper">
                <span class="region-selector-label">ğŸŒ ì—¬í–‰ì§€ ì„ íƒ:</span>
                <div class="region-selector-dropdown">
                    <select id="regionSelect" class="region-select" onchange="changeRegion(this.value)">
                        <option value="">ì§€ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</option>
                    </select>
                </div>
            </div>

            <h1 id="heroTitle">ë§ì¶¤ ì—¬í–‰ ìƒí’ˆ ì¶”ì²œ</h1>
            <p id="heroSubtitle">1ë¶„ ì„¤ë¬¸ìœ¼ë¡œ ë‚˜ì—ê²Œ ë”± ë§ëŠ” ìƒí’ˆ ì°¾ê¸°</p>
            <button class="cta-button" onclick="startSurvey()">
                <span>âœ¨</span>
                <span>ì„¤ë¬¸ ì‹œì‘í•˜ê¸°</span>
            </button>
            <div class="trust-indicators">
                <div class="trust-item">
                    <span>âœ“</span>
                    <span>ë¬´ë£Œ ì¶”ì²œ</span>
                </div>
                <div class="trust-item">
                    <span>âš¡</span>
                    <span>1ë¶„ ì†Œìš”</span>
                </div>
                <div class="trust-item">
                    <span>ğŸ¯</span>
                    <span>ë§ì¶¤í˜• ê²°ê³¼</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Survey Section -->
    <section class="survey-section" id="surveySection">
        <div class="container">
            <h2>ë‚˜ì—ê²Œ ë§ëŠ” ìƒí’ˆ ì°¾ê¸°</h2>
            <p class="subtitle">ê°„ë‹¨í•œ ì§ˆë¬¸ìœ¼ë¡œ ì™„ë²½í•œ ì—¬í–‰ ì¤€ë¹„í•˜ì„¸ìš”</p>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">ì§ˆë¬¸ 1 / 4</div>
            </div>

            <div id="questionsContainer"></div>
        </div>
    </section>

    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
        <div class="loading-text">ë§ì¶¤ ìƒí’ˆì„ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...</div>
    </div>

    <!-- Results Section -->
    <section class="results-section" id="resultsSection">
        <div class="container">
            <div class="results-header">
                <h2>ğŸ‰ ì—¬í–‰ìë‹˜ì„ ìœ„í•œ ë§ì¶¤ ì¶”ì²œ!</h2>
                <p id="resultsSubtitle"></p>
            </div>

            <div class="profile-card">
                <div class="profile-content">
                    <div class="profile-info">
                        <h3>ë‚˜ì˜ ì—¬í–‰ í”„ë¡œí•„</h3>
                        <div class="profile-badges" id="profileBadges"></div>
                    </div>
                    <div class="radar-chart-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>
                <div class="chart-description" id="chartDescription"></div>
            </div>

            <div class="timeline">
                <div class="timeline-step">
                    <div class="step-header">
                        <div class="step-icon">ğŸ›«</div>
                        <div class="step-info">
                            <div class="step-title">STEP 1. ì¶œêµ­ ì „ í•„ìˆ˜ ì¤€ë¹„</div>
                            <div class="step-subtitle">ì—¬í–‰ ì „ ê¼­ ì±™ê²¨ì•¼ í•  ê²ƒë“¤</div>
                        </div>
                    </div>
                    <div class="products-grid" id="step1Products"></div>
                </div>

                <div class="timeline-step">
                    <div class="step-header">
                        <div class="step-icon">ğŸ¨</div>
                        <div class="step-info">
                            <div class="step-title">STEP 2. ì™„ë²½í•œ ìˆ™ì†Œ</div>
                            <div class="step-subtitle">í¸ì•ˆí•œ íœ´ì‹ì„ ìœ„í•œ ì¶”ì²œ ìˆ™ì†Œ</div>
                        </div>
                    </div>
                    <div class="products-grid" id="step2Products"></div>
                </div>

                <div class="timeline-step">
                    <div class="step-header">
                        <div class="step-icon">ğŸ‰</div>
                        <div class="step-info">
                            <div class="step-title">STEP 3. ì—¬í–‰ ì¦ê¸°ê¸°</div>
                            <div class="step-subtitle">ìŠì§€ ëª»í•  íŠ¹ë³„í•œ ìˆœê°„ ë§Œë“¤ê¸°</div>
                        </div>
                    </div>
                    <div class="products-grid" id="step3Products"></div>
                </div>
            </div>

            <div class="email-capture">
                <h3>ğŸ“‹ ì¹œêµ¬ì—ê²Œ ì´ ì„¤ë¬¸ ì¶”ì²œí•˜ê¸°</h3>
                <p>ì¹œêµ¬ì—ê²Œ ì„¤ë¬¸ ë§í¬ë¥¼ ê³µìœ í•˜ê³ <br>ë§ì¶¤ ì—¬í–‰ ìƒí’ˆì„ ì¶”ì²œë°›ë„ë¡ ë„ì™€ì£¼ì„¸ìš”!</p>
                <div class="url-display" id="urlDisplay" style="display:none;">
                    <input type="text" id="urlInput" readonly>
                </div>
                <button class="email-submit" onclick="showAndCopyUrl()">ğŸ”— ì„¤ë¬¸ ë§í¬ ë³µì‚¬í•˜ê¸°</button>
                <div class="email-success" id="copySuccess">âœ“ ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
            </div>
        </div>
    </section>

    <!-- Exit Intent Popup -->
    <div class="exit-popup" id="exitPopup">
        <div class="exit-popup-content">
            <h3>ğŸ¤” ì´ëŒ€ë¡œ ë‚˜ê°€ì‹œë‚˜ìš”?</h3>
            <p>1ë¶„ë§Œ íˆ¬ìí•˜ë©´ ì™„ë²½í•œ ë§ì¶¤ ìƒí’ˆì„ ë°›ì•„ë³´ì‹¤ ìˆ˜ ìˆì–´ìš”!</p>
            <div class="exit-popup-buttons">
                <button class="btn-stay" onclick="closeExitPopup()">ê³„ì† ì§„í–‰í•˜ê¸°</button>
                <button class="btn-leave" onclick="closeExitPopup()">ë‚˜ê°€ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        // ===================================
        // êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì„¤ì •
        // ===================================
        const GOOGLE_SHEETS_CONFIG = {
            // ì—¬ê¸°ì— êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ CSV URLì„ ì…ë ¥í•˜ì„¸ìš”
            configUrl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQFNaDAFtso2Quna8a7lbcnXLZBc3_nUdDqvLIf3CCBKTuaSVWXSKRdfLoSvf_xjPejMwtftiTztLfq/pub?gid=0&single=true&output=csv',
            questionsUrl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQFNaDAFtso2Quna8a7lbcnXLZBc3_nUdDqvLIf3CCBKTuaSVWXSKRdfLoSvf_xjPejMwtftiTztLfq/pub?gid=2022399600&single=true&output=csv',
            productsUrl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQFNaDAFtso2Quna8a7lbcnXLZBc3_nUdDqvLIf3CCBKTuaSVWXSKRdfLoSvf_xjPejMwtftiTztLfq/pub?gid=756871285&single=true&output=csv'
        };

        // ===================================
        // ì „ì—­ ë³€ìˆ˜
        // ===================================
        let currentRegion = null;
        let configData = null;
        let allConfigData = []; // ëª¨ë“  ì§€ì—­ ì„¤ì •
        let questionsData = [];
        let productsData = [];
        let currentQuestion = 1;
        let answers = {};
        let exitIntentShown = false;

        // ===================================
        // ì§€ì—­ë³„ ì•„ì´ì½˜ ë§¤í•‘
        // ===================================
        const REGION_ICONS = {
            'las_vegas': 'ğŸ°',
            'tokyo': 'ğŸ—¼',
            'paris': 'ğŸ—¼',
            'london': 'ğŸ›ï¸',
            'jeju': 'ğŸï¸',
            'bangkok': 'ğŸ¯',
            'singapore': 'ğŸ¦',
            'hongkong': 'ğŸ™ï¸',
            'newyork': 'ğŸ—½',
            'rome': 'ğŸ›ï¸',
            'barcelona': 'ğŸ°',
            'sydney': 'ğŸŒŠ'
        };

        // ===================================
        // ë°ì´í„° ë¡œë”© í•¨ìˆ˜
        // ===================================
        async function loadCSVData(url) {
            return new Promise((resolve, reject) => {
                Papa.parse(url, {
                    download: true,
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        resolve(results.data);
                    },
                    error: function(error) {
                        reject(error);
                    }
                });
            });
        }

        // ===================================
        // ì§€ì—­ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        // ===================================
        async function initializeRegionSelector() {
            try {
                // Config ë°ì´í„° ë¡œë“œ (ëª¨ë“  ì§€ì—­)
                allConfigData = await loadCSVData(GOOGLE_SHEETS_CONFIG.configUrl);
                
                const selectElement = document.getElementById('regionSelect');
                
                // URL íŒŒë¼ë¯¸í„°ì—ì„œ region ê°€ì ¸ì˜¤ê¸°
                const urlParams = new URLSearchParams(window.location.search);
                const urlRegion = urlParams.get('region');
                
                // ê¸°ë³¸ê°’ ì„¤ì • (URL íŒŒë¼ë¯¸í„° > ì²« ë²ˆì§¸ ì§€ì—­)
                currentRegion = urlRegion || allConfigData[0]?.region_id || 'las_vegas';
                
                // ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ìƒì„±
                selectElement.innerHTML = allConfigData.map(region => {
                    const icon = REGION_ICONS[region.region_id] || 'âœˆï¸';
                    const selected = region.region_id === currentRegion ? 'selected' : '';
                    return `<option value="${region.region_id}" ${selected}>${icon} ${region.region_name_ko}</option>`;
                }).join('');
                
            } catch (error) {
                console.error('ì§€ì—­ ì„ íƒ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                document.getElementById('regionSelect').innerHTML = '<option value="">ì˜¤ë¥˜ ë°œìƒ</option>';
            }
        }

        // ===================================
        // ì§€ì—­ ë³€ê²½ ì²˜ë¦¬
        // ===================================
        function changeRegion(newRegion) {
            if (newRegion && newRegion !== currentRegion) {
                // URL ì—…ë°ì´íŠ¸
                const newUrl = `${window.location.pathname}?region=${newRegion}`;
                window.location.href = newUrl;
            }
        }

        // ===================================
        // ì•± ì´ˆê¸°í™”
        // ===================================
        async function initializeApp() {
            try {
                // ì§€ì—­ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
                await initializeRegionSelector();
                
                // Questionsì™€ Products ë°ì´í„° ë¡œë“œ
                const [questions, products] = await Promise.all([
                    loadCSVData(GOOGLE_SHEETS_CONFIG.questionsUrl),
                    loadCSVData(GOOGLE_SHEETS_CONFIG.productsUrl)
                ]);

                // í˜„ì¬ ì§€ì—­ì— ë§ëŠ” ë°ì´í„° í•„í„°ë§
                configData = allConfigData.find(row => row.region_id === currentRegion);
                questionsData = questions.filter(row => row.region_id === currentRegion);
                productsData = products.filter(row => row.region_id === currentRegion);

                if (!configData) {
                    throw new Error(`ì§€ì—­ '${currentRegion}'ì˜ ì„¤ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                }

                // UI ë Œë”ë§
                renderHeroSection();
                renderSurveySection();
                updateProgress();

                // ì´ˆê¸° ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê¸°
                document.getElementById('initialLoading').classList.add('hidden');

                // URL íŒŒë¼ë¯¸í„°ë¡œ ë‹µë³€ì´ ì „ë‹¬ëœ ê²½ìš° ê²°ê³¼ í‘œì‹œ
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.has('companion') && urlParams.has('style') && 
                    urlParams.has('priority') && urlParams.has('destination')) {
                    answers = {
                        companion: urlParams.get('companion'),
                        style: urlParams.get('style'),
                        priority: urlParams.get('priority'),
                        destination: urlParams.get('destination')
                    };
                    showResultsDirectly();
                }
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
                document.getElementById('initialLoading').innerHTML = `
                    <div style="text-align: center; color: white;">
                        <h2>âš ï¸ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨</h2>
                        <p>${error.message}</p>
                        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: white; color: #667eea; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">ë‹¤ì‹œ ì‹œë„</button>
                    </div>
                `;
            }
        }

        // ===================================
        // Hero ì„¹ì…˜ ë Œë”ë§
        // ===================================
        function renderHeroSection() {
            document.getElementById('heroTitle').textContent = 
                `${configData.region_name_ko} ë§ì¶¤ ì—¬í–‰ ìƒí’ˆ ì¶”ì²œ`;
            document.getElementById('heroSubtitle').textContent = 
                configData.tagline || '1ë¶„ ì„¤ë¬¸ìœ¼ë¡œ ë‚˜ì—ê²Œ ë”± ë§ëŠ” ìƒí’ˆ ì°¾ê¸°';
        }

        // ===================================
        // Survey ì„¹ì…˜ ë Œë”ë§
        // ===================================
        function renderSurveySection() {
            const container = document.getElementById('questionsContainer');
            
            // ì§ˆë¬¸ë³„ë¡œ ê·¸ë£¹í™”
            const questionGroups = {};
            questionsData.forEach(row => {
                if (!questionGroups[row.question_id]) {
                    questionGroups[row.question_id] = {
                        order: parseInt(row.question_order),
                        text: row.question_text,
                        answer_key: row.answer_key,
                        options: []
                    };
                }
                questionGroups[row.question_id].options.push({
                    id: row.option_id,
                    order: parseInt(row.option_order),
                    icon: row.option_icon,
                    text: row.option_text,
                    desc: row.option_desc
                });
            });

            // ì§ˆë¬¸ ìˆœì„œëŒ€ë¡œ ì •ë ¬
            const sortedQuestions = Object.entries(questionGroups)
                .sort(([, a], [, b]) => a.order - b.order);

            // HTML ìƒì„±
            container.innerHTML = sortedQuestions.map(([qId, qData], idx) => {
                const isActive = idx === 0 ? 'active' : '';
                const showBack = idx > 0;
                
                // ì˜µì…˜ ì •ë ¬
                const sortedOptions = qData.options.sort((a, b) => a.order - b.order);
                
                return `
                    <div class="question ${isActive}" id="question${idx + 1}" data-answer-key="${qData.answer_key}">
                        ${showBack ? '<div class="question-nav"><button class="btn-back" onclick="previousQuestion()">â† ì´ì „ ì§ˆë¬¸</button></div>' : ''}
                        <h3>${qData.text}</h3>
                        <div class="options">
                            ${sortedOptions.map(opt => `
                                <div class="option" onclick="selectOption('${qData.answer_key}', '${opt.id}', ${idx + 1})">
                                    <div class="option-icon">${opt.icon}</div>
                                    <div class="option-text">${opt.text}</div>
                                    ${opt.desc ? `<div class="option-desc">${opt.desc}</div>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ===================================
        // ì„¤ë¬¸ ì‹œì‘
        // ===================================
        function startSurvey() {
            document.getElementById('surveySection').scrollIntoView({ behavior: 'smooth' });
        }

        // ===================================
        // ì˜µì…˜ ì„ íƒ
        // ===================================
        function selectOption(answerKey, optionId, questionNum) {
            answers[answerKey] = optionId;
            
            // ì„ íƒëœ ì˜µì…˜ ì‹œê°ì  í‘œì‹œ
            const currentQuestion = document.getElementById(`question${questionNum}`);
            currentQuestion.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            event.currentTarget.classList.add('selected');

            // ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ
            setTimeout(() => {
                if (questionNum < 4) {
                    nextQuestion();
                } else {
                    showResults();
                }
            }, 300);
        }

        // ===================================
        // ë‹¤ìŒ/ì´ì „ ì§ˆë¬¸
        // ===================================
        function nextQuestion() {
            document.getElementById(`question${currentQuestion}`).classList.remove('active');
            currentQuestion++;
            document.getElementById(`question${currentQuestion}`).classList.add('active');
            updateProgress();
            document.getElementById('surveySection').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function previousQuestion() {
            document.getElementById(`question${currentQuestion}`).classList.remove('active');
            currentQuestion--;
            document.getElementById(`question${currentQuestion}`).classList.add('active');
            updateProgress();
        }

        function updateProgress() {
            const progress = (currentQuestion / 4) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `ì§ˆë¬¸ ${currentQuestion} / 4`;
        }

        // ===================================
        // ê²°ê³¼ í‘œì‹œ
        // ===================================
        function showResults() {
            document.getElementById('loadingScreen').classList.add('active');
            
            setTimeout(() => {
                calculateAndDisplayResults();
                document.getElementById('loadingScreen').classList.remove('active');
                document.getElementById('surveySection').style.display = 'none';
                document.getElementById('resultsSection').classList.add('active');
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
            }, 2000);
        }

        function showResultsDirectly() {
            calculateAndDisplayResults();
            document.getElementById('heroSection').style.display = 'none';
            document.getElementById('surveySection').style.display = 'none';
            document.getElementById('resultsSection').classList.add('active');
        }

        function calculateAndDisplayResults() {
            // í”„ë¡œí•„ ë°°ì§€
            const optionTexts = {};
            questionsData.forEach(row => {
                if (answers[row.answer_key] === row.option_id) {
                    optionTexts[row.answer_key] = row.option_text;
                }
            });

            document.getElementById('profileBadges').innerHTML = Object.entries(optionTexts)
                .map(([key, text]) => `<div class="badge">${text}</div>`)
                .join('');

            document.getElementById('resultsSubtitle').textContent = 
                `${configData.region_name_ko} ì—¬í–‰ì„ ìœ„í•œ ë§ì¶¤ ì¶”ì²œ ìƒí’ˆì…ë‹ˆë‹¤`;

            // ë ˆì´ë” ì°¨íŠ¸
            renderRadarChart();

            // ìƒí’ˆ ì¶”ì²œ
            renderRecommendedProducts();
        }

        // ===================================
        // ìƒí’ˆ ì¶”ì²œ ë¡œì§
        // ===================================
        function renderRecommendedProducts() {
            const steps = [1, 2, 3];
            
            steps.forEach(step => {
                const stepProducts = productsData.filter(p => parseInt(p.step) === step);
                const scoredProducts = stepProducts.map(product => ({
                    ...product,
                    score: calculateProductScore(product)
                })).sort((a, b) => b.score - a.score);

                const container = document.getElementById(`step${step}Products`);
                container.innerHTML = scoredProducts.slice(0, 6).map(product => `
                    <div class="product-card">
                        <div class="product-header">
                            <div class="product-name">${product.name}</div>
                            <div class="product-price">${product.price}</div>
                        </div>
                        <div class="product-reason">${product.reason}</div>
                        <div class="product-desc">${product.desc}</div>
                        <div class="product-tags">
                            ${product.tags.split(',').slice(0, 4).map(tag => 
                                `<div class="product-tag">${tag.trim()}</div>`
                            ).join('')}
                        </div>
                    </div>
                `).join('');
            });
        }

        function calculateProductScore(product) {
            let score = 0;
            
            const targets = {
                companion: product.target_companion,
                priority: product.target_priority,
                style: product.target_style,
                destination: product.target_destination
            };

            Object.entries(answers).forEach(([key, value]) => {
                if (targets[key] && targets[key].includes(value)) {
                    score += key === 'priority' ? 40 : 20;
                }
            });

            return score;
        }

        // ===================================
        // ë ˆì´ë” ì°¨íŠ¸
        // ===================================
        function renderRadarChart() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            
            let baseValues = {
                safety: 60,
                communication: 60,
                convenience: 60,
                value: 60,
                experience: 60,
                special: 60
            };

            if (answers.priority === 'safety') { 
                baseValues.safety = 95; 
                baseValues.convenience = 85; 
            } else if (answers.priority === 'communication') { 
                baseValues.communication = 95; 
                baseValues.convenience = 90; 
            } else if (answers.priority === 'value') { 
                baseValues.value = 95; 
                baseValues.convenience = 85; 
            } else if (answers.priority === 'experience') { 
                baseValues.experience = 95; 
                baseValues.special = 90; 
            }

            if (answers.style === 'photo') { 
                baseValues.special = Math.min(100, baseValues.special + 10); 
            } else if (answers.style === 'food') { 
                baseValues.experience = Math.min(100, baseValues.experience + 10); 
            } else if (answers.style === 'planned') { 
                baseValues.convenience = Math.min(100, baseValues.convenience + 5); 
            } else if (answers.style === 'spontaneous') { 
                baseValues.experience = Math.min(100, baseValues.experience + 5); 
            }

            if (answers.companion === 'family') { 
                baseValues.safety = Math.min(100, baseValues.safety + 10); 
            } else if (answers.companion === 'couple') { 
                baseValues.special = Math.min(100, baseValues.special + 5); 
            } else if (answers.companion === 'friends') { 
                baseValues.experience = Math.min(100, baseValues.experience + 5); 
            }

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['ì•ˆì „ì„±', 'í¸ë¦¬í•œ ì†Œí†µ', 'í¸ì˜ì„±', 'ê°€ì„±ë¹„', 'í˜„ì§€ ê²½í—˜', 'íŠ¹ë³„í•¨'],
                    datasets: [{
                        label: 'ë‚˜ì˜ ì—¬í–‰ ìŠ¤íƒ€ì¼',
                        data: Object.values(baseValues),
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 3,
                        pointBackgroundColor: 'rgba(118, 75, 162, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(118, 75, 162, 1)',
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true, 
                            max: 100, 
                            ticks: { stepSize: 20, display: false },
                            pointLabels: { 
                                font: { size: 14, family: 'Noto Sans KR', weight: '600' }, 
                                color: '#333' 
                            },
                            grid: { color: 'rgba(0, 0, 0, 0.05)' },
                            angleLines: { color: 'rgba(0, 0, 0, 0.05)' }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: { 
                            enabled: true, 
                            callbacks: { 
                                label: function(context) { 
                                    return context.dataset.label + ': ' + context.formattedValue; 
                                } 
                            } 
                        }
                    }
                }
            });

            const priorityNames = {
                safety: 'ì•ˆì „ì„±', 
                communication: 'í¸ë¦¬í•œ ì†Œí†µ', 
                value: 'ê°€ì„±ë¹„', 
                experience: 'íŠ¹ë³„í•œ ê²½í—˜'
            };
            document.getElementById('chartDescription').textContent = 
                `ì—¬í–‰ìë‹˜ì€ '${priorityNames[answers.priority]}'ì„(ë¥¼) ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ì‹œëŠ”êµ°ìš”! ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒí’ˆì„ ì¶”ì²œí•´ ë“œë ¸ì–´ìš”.`;
        }

        // ===================================
        // URL ë³µì‚¬ ê¸°ëŠ¥
        // ===================================
        function showAndCopyUrl() {
            const surveyUrl = window.location.origin + window.location.pathname + '?region=' + currentRegion;
            document.getElementById('urlDisplay').style.display = 'block';
            document.getElementById('urlInput').value = surveyUrl;
            const input = document.getElementById('urlInput');
            input.focus();
            input.select();
            
            try {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(surveyUrl).then(() => {
                        document.getElementById('copySuccess').textContent = 'âœ“ ì„¤ë¬¸ ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!';
                        document.getElementById('copySuccess').classList.add('show');
                        setTimeout(() => { 
                            document.getElementById('copySuccess').classList.remove('show'); 
                        }, 2000);
                    }).catch(err => {
                        document.getElementById('copySuccess').textContent = 'ë³µì‚¬ ì‹¤íŒ¨! ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.';
                        document.getElementById('copySuccess').classList.add('show');
                    });
                } else {
                    document.getElementById('copySuccess').textContent = 'ë¸Œë¼ìš°ì €ì—ì„œ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.';
                    document.getElementById('copySuccess').classList.add('show');
                }
            } catch (err) {
                document.getElementById('copySuccess').textContent = 'ì˜¤ë¥˜ ë°œìƒ! ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.';
                document.getElementById('copySuccess').classList.add('show');
            }
            
            input.onclick = function() { this.select(); };
        }

        // ===================================
        // Exit Intent Popup
        // ===================================
        document.addEventListener('mouseleave', (e) => {
            if (e.clientY <= 0 && !exitIntentShown && !document.getElementById('resultsSection').classList.contains('active')) {
                showExitPopup();
            }
        });

        function showExitPopup() {
            exitIntentShown = true;
            document.getElementById('exitPopup').classList.add('active');
        }

        function closeExitPopup() {
            document.getElementById('exitPopup').classList.remove('active');
        }

        // ===================================
        // ì•± ì´ˆê¸°í™”
        // ===================================
        window.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
